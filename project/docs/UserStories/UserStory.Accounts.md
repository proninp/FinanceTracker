# User Story: Управление счетами и отслеживание баланса

Как пользователь, я хочу управлять своими финансовыми счетами (создавать, редактировать, архивировать, удалять, настраивать параметры),
чтобы контролировать источники средств, видеть актуальные балансы и анализировать общее финансовое положение.

---

## User Story 1: Просмотр списка счетов

Как пользователь, я хочу видеть список всех своих счетов с текущими балансами, чтобы понимать своё финансовое положение.

**Acceptance Criteria:**

- Отображается список всех активных счетов.
- Для каждого счёта показываются:
  - название счёта,
  - тип счёта (Наличные, Карта, Банковский счет, Кредит, Депозит),
  - банк (если выбран),
  - текущий баланс,
  - валюта счёта.
- Счета, отмеченные как "архивные", отображаются в отдельной секции или по фильтру "Архив".
- Под списком отображается **итоговый баланс** - сумма всех счетов, включённых в общий баланс.
- Поддерживается поиск и фильтрация по названию, банку и типу счета.

**Business Value:**
Позволяет пользователю видеть финансовую картину целиком и быстро находить нужный счёт.

---

## User Story 2: Создание нового счёта

Как пользователь, я хочу создать новый счёт, чтобы учитывать средства в разрезе нескольких источников.

**Acceptance Criteria:**

Пользователь может указать:
- Название счёта (обязательно);
- Тип счёта:
  - Наличные,
  - Карта,
  - Банковский счёт,
  - Кредит,
  - Депозит;
- Валюту из выпадающего списка валют;
- Текущий баланс (обязательно);
- Кредитный лимит (для кредитных счетов);
- Признак "Включать в общий баланс" (да/нет);
- Признак "Счёт по умолчанию";
- Банк счёта (из выпадающего списка, при наличии);
- Тип счёта по режиму: **накопительный / обычный**.

**Пайплайн создания счёта:**
1. Начато создание счёта → перейти в режим создания.
2. Ввод названия счёта → зафиксировать название.
3. Отобразить и выбрать тип счёта → зафиксировать тип.
4. Отобразить список валют → выбрать и зафиксировать валюту.
5. Указать кредитный лимит → зафиксировать лимит (опционально).
6. Указать текущий баланс → зафиксировать баланс.
7. Выбрать, включать ли в общий баланс → зафиксировать выбор.
8. Выбрать, установить ли, как счёт по умолчанию → зафиксировать.
9. Получить список банков → выбрать банк или пропустить шаг → зафиксировать.
10. Выбрать тип счёта (накопительный / обычный) → зафиксировать.
11. Сохранить и создать счёт.

**Дополнительно:**
- При создании с одинаковым названием в одной валюте — предупреждение о дубликате.
- После сохранения счёт появляется в общем списке и учитывается в балансе (если не исключён).

**Business Value:**
Позволяет пользователю вести учёт разных источников средств и контролировать балансы по каждому.

---

## User Story 3: Редактирование счёта

Как пользователь, я хочу иметь возможность изменять параметры существующего счёта, чтобы актуализировать данные или скорректировать ошибки.

**Acceptance Criteria:**

- Пользователь может изменить:
  - название счёта,
  - тип счёта,
  - банк,
  - статус "включать в общий баланс",
  - режим "по умолчанию",
  - установить признак "Архивный" для счета.
- При изменении валюты:
  - существующие транзакции сохраняются с прежней валютой;
  - только новые операции будут использовать новую валюту.
- Все изменения сохраняются мгновенно и применяются при последующем отображении списка и балансов.
- Если счёт был "по умолчанию" и назначается другой - статус обновляется.

**Business Value:**  
Позволяет корректировать информацию без потери данных и повышает точность финансового учёта.

---

## User Story 4: Архивирование счёта

Как пользователь, я хочу архивировать счёт, который больше не использую, чтобы не загромождать интерфейс, но сохранять историю операций.

**Acceptance Criteria:**

- Пользователь может перевести счёт в состояние "Архивный".
- Архивный счёт:
  - не участвует в расчёте общего баланса;
  - скрыт из основного списка (по умолчанию);
  - доступен через фильтр “Архивные счета”;
  - остаётся доступным для просмотра истории транзакций.
- Архивный счёт можно вернуть в активные.

**Business Value:**  
Позволяет сохранять историю без потери данных и поддерживать чистоту интерфейса.

---

## User Story 5: Удаление счёта

Как пользователь, я хочу удалить счёт, который мне больше не нужен, чтобы убрать ненужную информацию из системы.

**Acceptance Criteria:**

- При удалении отображается предупреждение и запрос подтверждения.
- Если к счёту привязаны операции:
  - пользователю предлагается архивировать счёт вместо удаления;
  - либо удалить вместе с операциями (если нет необходимости сохранять историю).
- После удаления счёт исчезает из списка и не участвует в расчётах.
- Удалённые счета могут сохраняться в системе в виде soft delete для целей аудита.

**Business Value:**  
Обеспечивает контроль над структурой счетов и защищает от случайных ошибок.

---

## User Story 6: Установка счёта по умолчанию

Как пользователь, я хочу установить конкретный счёт по умолчанию, чтобы он автоматически подставлялся при создании новых транзакций.

**Acceptance Criteria:**

- В настройках счёта есть флаг "Счёт по умолчанию".
- Может быть только один активный счёт по умолчанию.
- При назначении нового счёта по умолчанию предыдущий теряет этот статус.
- При создании новой транзакции по умолчанию подставляется этот счёт.

**Business Value:**
Ускоряет создание операций и снижает вероятность ошибок при выборе счёта.

---

## User Story 7: Отображение баланса и аналитика по счетам

Как пользователь, я хочу видеть сводную информацию по балансу всех счетов, чтобы быстро оценить своё финансовое положение и динамику изменений.

**Acceptance Criteria:**

- Отображается общий баланс всех активных счетов, включённых в общий расчёт.
- Балансы отображаются в валюте счёта и, при необходимости, конвертируются в основную валюту пользователя (по текущему курсу).
- Поддерживается фильтр:
  - только активные счета,
  - только архивные,
  - все.
- Отображается диаграмма распределения средств по типам счетов.

**Business Value:**
Делает финансовое состояние пользователя прозрачным и легко анализируемым.

---

## 💡 Technical / UX Notes

- Все счета хранятся в таблице `accounts` со ссылками на:
  - `currencies` (1:N);
  - `banks` (1:N);
  - `transactions` (N:1);
- Поддержка soft delete (`is_deleted`, `is_archived`, `is_default`, `include_in_total`).
- Конвертация валют при расчёте общего баланса выполняется через API курсов валют (например, ECB или ЦБ РФ).
- Возможность будущего расширения:
  - интеграция с банковским API (для автоматического обновления баланса),
  - поддержка мультивалютных счетов,
  - возможность привязки карт и лимитов расходов по счёту.

---

**Навигация:**  
[← К списку UserStory](../UserStory.md) | [К следующей UserStory →](./UserStory.Categories.md)